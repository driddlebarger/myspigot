<div class="wrapper">

<script type="text/javascript">
    mixpanel.track("Add Location (Page)");
</script>

<script>
  var touchEvent = 'ontouchstart' in window ? 'touchstart' : 'click';
</script>


<div id='map' class='map-small'>
    <script>
//  Mapbox GL code 
    mapboxgl.accessToken = 'pk.eyJ1IjoiZHJpZGRsZWJhcmdlciIsImEiOiJjajh3aWhkbDMxczRiMzJvNGQ0azU3NjN5In0.o2fPEeGh3pH2-AeAAR0seQ';
      
      var startPos;
        navigator.geolocation.watchPosition(function(position) {
          startPos = position;
          var startLat = startPos.coords.latitude;
          console.log(startLat);
          document.getElementById("latitude").value = startLat;
          var startLong = startPos.coords.longitude;
          console.log(startLong);
          document.getElementById("longitude").value = startLong;
          //startCoords = [startLong, startLat];
          //map.setCenter(startCoords);
        });

      var map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/light-v9',
        center: startPos,
        zoom: 10.0 // starting zoom
      });

      const geolocate = new mapboxgl.GeolocateControl({
                positionOptions: {
                enableHighAccuracy: true
                },
                trackUserLocation: true
            })
      map.addControl(geolocate)
      setTimeout(geolocate._onClickGeolocate.bind(geolocate), 5)


    </script>

</div>

<div class="form-signin">

<h3>Add a New Location</h3>
<p>Add a new water spot to our database!</p>

  <%= form_for @submission do |f| %>

      <div class="form-control">
      <%= f.text_field :name, required: true, placeholder: "Give it a name!" %>
      </div>

      <div>
      <%= f.text_area :description, required: true, as: :text, class: "form-control", rows: "3", placeholder: "Describe it! How can we find it? What's it next to? Does the water taste good?" %>
      </div>

    <hr>
      


      <div class="hidden">
      <%= f.text_field :latitude, placeholder: "Latitude", id: "latitude" %>
      </div>

      <div class="hidden">
      <%= f.text_field :longitude, placeholder: "Longitude", id: "longitude" %> 
      </div>

      <div class="hidden">
      <%= f.label :nickname %><br>
      <%= f.text_field :nickname, hint: 'leave this field blank' %>
      </div>

      <!-- add current user email as hidden field -->
      <div class="hidden">
      <%= f.label :email %><br>
      <%= f.text_field :email, :value => current_user.email %>
      </div>


    <div class="form-group">
    <%= f.submit 'Submit Location!', class: "btn btn-lg btn-primary btn-block" %>
    <% end %>
    </div>



</div>
</div>
